---
title: 'Pterodactyl Docker Compose Installation'
key: pterodactyl-docker
description: 'A few simple Docker Compose files to easily setup Pterodactyl!'
date: 12-25-2023
tags: ["guide", "pterodactyl", "docker"]
layout: ../../layouts/ArticleLayout.astro
---

import Ext from '../../components/Ext.astro';
import Code from '../../components/Code.astro';

Pterodactyl's great! Unfortunately the documentation on how to install Pterodactyl is still lacking.

When I was in middle school (*in the United States*), I tried to install Pterodactyl and ended up 
having to restart at least 10 (!) times because of minor mistakes. The only installations that ended 
up working first try were the installer scripts which often harbored their own issues.

We now live in the age where you can just use Docker and Docker Compose to deploy everything easily.
It's a shame though that the official 
<Ext href="https://pterodactyl.io/panel/1.0/getting_started.html">documentation</Ext>
has no Docker Compose instructions to show for it.

Enough waffling. Here's how to easily configure it.

---

Basic assumptions (if you know what you are doing, this guide is still fine):
- You have a domain and it is correctly set up to point `panel.domain.com` and `node.domain.com` to your server
- Docker is running on root (unfortunately rootless `cgroupsv2` is broken with non Systemd systems)
- Docker is running in an environment that supports `cgroupsv2` to limit container resource usage
- Firewall allows: 80/tcp, 443/tcp, 443/udp, and 2022/tcp

---

In the course of the guide, you should place all the individual components in separate folders.
A file structre like the following should suffice:

<Code language="tree" name="File Structure">
```
.
├─ panel/
│  └ docker-compose.yml
├─ wings/
│  └ docker-compose.yml
├─ caddy/
│  └ docker-compose.yml
│  └ Caddyfile
...
```
</Code>

Let's start with the easy part (the panel) first (*read the instructions!*):

<Code language="Bash" name="Panel's Docker Compose" source="https://raw.githubusercontent.com/pterodactyl/panel/develop/docker-compose.example.yml">
```bash
# download the docker-compose.yml file
curl -so docker-compose.yml "https://raw.githubusercontent.com/pterodactyl/panel/develop/docker-compose.example.yml"
# magic to change the default database password to a secure random value
# (you won't need it for anything else unless you plan to reuse the database in which case you'd want to create a separate database compose file)
sed -i "s/\"CHANGE_ME\"/\"$(tr -dc A-Za-z0-9 < /dev/random | head -c 8)\"/" docker-compose.yml
sed -i "s/\"CHANGE_ME_TOO\"/\"$(tr -dc A-Za-z0-9 < /dev/random | head -c 8)\"/" docker-compose.yml

#
# edit the file `docker-compose.yml`
# change the `APP_URL` property to where your panel will be
# i.e. https://panel.kunet.dev
#

# now it's time to start it up
docker-compose up -d

# create a user for later
docker exec -it panel_panel_1 php artisan p:user:make
```
</Code>

Now, let's move on to Wings which is an altered configuration since we're going to wire it up to Caddy later.

<Code language="YAML" name="docker-compose.yml" source="https://raw.githubusercontent.com/pterodactyl/wings/develop/docker-compose.example.yml">
```yaml
version: '3.8'
services:
  wings:
    image: ghcr.io/pterodactyl/wings:latest
    restart: always
    networks:
      - caddy
    ports:
      - "2022:2022"
    tty: true
    environment:
      TZ: "UTC"
      WINGS_UID: 988
      WINGS_GID: 988
      WINGS_USERNAME: pterodactyl
    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock"
      - "/var/lib/docker/containers/:/var/lib/docker/containers/"
      - "/etc/pterodactyl/:/etc/pterodactyl/"
      - "/var/lib/pterodactyl/:/var/lib/pterodactyl/"
      - "/var/log/pterodactyl/:/var/log/pterodactyl/"
      - "/tmp/pterodactyl/:/tmp/pterodactyl/"
      - "/etc/ssl/certs:/etc/ssl/certs:ro"
networks:
  caddy:
    external: true
    name: caddy
    driver: bridge
```
</Code>

Don't start `wings` quite yet... we'll get back to that soon enough.

It would be a good time now to create the Caddy network:

<Code language="Bash" name="Create Caddy network">
```bash
docker network create caddy --driver bridge --subnet 172.14.0.0/16
```
</Code>

Oh, and here's the Caddy Docker Compose file:

<Code language="YAML" name="Caddy's Docker Compose">
```yaml
version: '3.8'
services:
  caddy:
    container_name: caddy
    networks:
      - caddy
    image: caddy:alpine
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
      - "443:443/udp"
    volumes:
      - $PWD/Caddyfile:/etc/caddy/Caddyfile
      - $PWD/caddy_data:/data
      - $PWD/caddy_config:/config
    command: "sh -c 'caddy fmt -w /etc/caddy/Caddyfile && caddy run --config /etc/caddy/Caddyfile --adapter caddyfile'"
networks:
  caddy:
    external: true
    name: caddy
    driver: bridge
```
</Code>

*This is an especially cool Caddy config since it automatically formats the Caddyfile on boot!*

And inside the same folder that the Caddy `docker-compose.yml` file is in is the `Caddyfile`.
Change the domains to the domains to your domains but keep the `http://panel` and `http://wings:8080`
as they are automatically correctly routed to the other containers through the magic of Docker's DNS:

<Code language="Caddyfile" name="Caddyfile">
```caddy
panel.kunet.dev {
    reverse_proxy http://panel
}

node.kunet.dev {
    reverse_proxy http://wings:8080
}
```
</Code>

These commands on Linux will increase the maximum UDP buffer size, which you might want to do for <Ext href="https://github.com/quic-go/quic-go/wiki/UDP-Buffer-Sizes">performance reasons</Ext> for QUIC (which runs on UDP) and is enabled by default in Caddy:

<Code language="Bash" name="Increase UDP buffer size">
```bash
# needs to be run as root
sysctl -w net.core.rmem_max=2500000
sysctl -w net.core.wmem_max=2500000
```
</Code>
